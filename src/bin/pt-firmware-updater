#!/usr/bin/python3

from argparse import ArgumentParser
from sys import argv, exit, path
path.append("/usr/lib/pt-firmware-updater/")
from hub_communicator import HubCommunicator

parser = ArgumentParser(description="pi-top update checker")
parser.add_argument(
    "--addr",
    type=lambda x: int(x, 0),  # hex or int
    help="set the I2C address to target for upgrade",
    required=True,
)
parser.add_argument(
    "--file",
    type=str,
    help="path to firmware bin file",
    required=True,
)
parser.add_argument(
    "--interval",
    type=float,
    help="set the packet interval speed",
    default=0.1
)

args = parser.parse_args()

# TODO: check that hardware version is compatible

# TODO: check that I2C lock is not taken

# TODO: Low priority - If address not defined, ask user to specify or auto-detect if only hub is available

# TODO: High priority - check I2C address is found and is pi-top device (PART_NUMBER?)

# TODO: If path not defined, ask user to specify or use latest?

# TODO: High priority - check path exists

HubCommunicator(args.addr, args.file, args.interval).update_firmware()
